<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Boxicons -->
	<link href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css" rel="stylesheet">
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
	<!-- My CSS -->
	<link href="~/adminpanel/css/style.css" rel="stylesheet" />
	<link href="~/login11_6/css/style.css" rel="stylesheet" />
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<title>@ViewBag.Title - AdminHub</title>
</head>

<body>

	<!-- SIDEBAR -->
	<section id="sidebar">
		<div class="sidebar-header">
			<a href="#" class="brand">
				<i>
					<img src="~/img(4uu)/logo ci.png"
						style="width: 200px; height: auto; margin-top: 40px; margin-left:20px;" alt="CI Research Logo"
						onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" />
					<span style="display: none; font-size: 18px; font-weight: bold; color: var(--blue);">CI
						RESEARCH</span>
				</i>
			</a>
		</div>

		<ul class="side-menu top">






			@if (Context.Session.GetString("Username") != null)
			{
				var userRole = Context.Session.GetString("Role"); // Lấy vai trò từ session




				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
						data-tooltip="Dữ liệu công ty">
						<i class='bx bxs-briefcase'></i>
						<span class="text">Dữ liệu công ty</span>
					</a>
					<ul class="dropdown-menu">


						<li>
							<a href="@Url.Action("Index", "Bacsi")" data-tooltip="Bác sĩ">
								<span class="text">Bác sĩ</span>

							</a>
						</li>

						<li>
							<a href="@Url.Action("Index", "Manhinhchinh")" data-tooltip="Consumer">
								<span class="text">Consumer</span>
							</a>
						</li>



					</ul>
				</li>




				<li>
					<a href="@Url.Action("ViewProfile", "Profile")" data-tooltip="Hồ sơ của tôi">
						<i class='bx bxs-user'></i>
						<span class="text">Hồ sơ của tôi</span>
					</a>
				</li>
				<li>
					<a href="@Url.Action("ChangePassword", "LoginRegister")" data-tooltip="Đổi mật khẩu">
						<i class='bx bxs-lock'></i>
						<span class="text">Đổi mật khẩu</span>
					</a>
				</li>


				@if (userRole == "Manager")
				{

					<li>
						<a href="@Url.Action("Index", "Tracuulocxuat")" data-tooltip="Lịch sử lọc xuất">
							<i class='bx bx-history'></i>
							<span class="text">Lịch sử lọc xuất</span>
						</a>
					</li>

				}




				@if (userRole == "Admin")
				{

					@* 	<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class='bx bxs-briefcase'></i>
							<span class="text">Dự án đang chạy</span>
						</a>
						<ul class="dropdown-menu">


							<li>
								<a href="@Url.Action("Index", "FutusProject")">
									<span class="text">Dự án Futus</span>
								</a>
							</li>

							<li>
								<a href="@Url.Action("Index", "Home")">
									<span class="text">Dự án 2</span>
								</a>
							</li>

							<li>
								<a href="@Url.Action("Index", "Home")">
									<span class="text">Dự án 3</span>
								</a>
							</li>

						</ul>
					</li> *@

					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
							data-tooltip="Thông tin doanh nghiệp">
							<i class='bx bxs-briefcase'></i>
							<span class="text">Thông tin doanh nghiệp</span>
						</a>
						<ul class="dropdown-menu">

							<li>
								<a href="@Url.Action("Index", "DNInsert")">
									<span class="text">Thêm doanh nghiệp mới</span>
								</a>
							</li>

							<li>
								<a href="@Url.Action("Index", "DNImport")">
									<span class="text">Import từ Excel</span>
								</a>
							</li>

							<li>
								<a href="@Url.Action("Index", "DN")">
									<span class="text">Năm 2023</span>

								</a>
							</li>

							<li>
								<a href="@Url.Action("Index", "DN")">
									<span class="text">Năm 2021</span>
								</a>
							</li>

							<li>
								<a href="@Url.Action("Index", "DN")">
									<span class="text">Năm 2022</span>
								</a>
							</li>

						</ul>
					</li>




					<li>
						<a href="@Url.Action("Index", "Admin")" data-tooltip="Trang admin">
							<i class='bx bxs-user-plus'></i>
							<span class="text">Trang admin</span>
						</a>
					</li>

					<li>
						<a href="@Url.Action("Register", "LoginRegister")" data-tooltip="Đăng ký tài khoản">
							<i class='bx bxs-user-plus'></i>
							<span class="text">Đăng ký tài khoản</span>
						</a>
					</li>
					<li>
						<a href="@Url.Action("Index", "ManageUsers")" data-tooltip="Quản lý tài khoản">
							<i class='bx bxs-cog'></i>
							<span class="text">Quản lý tài khoản</span>
						</a>
					</li>
					<li>
						<a href="@Url.Action("Index", "ALLDATA")" data-tooltip="Thêm dữ liệu dự án">
							<i class='bx bxs-data'></i>
							<span class="text">Thêm dữ liệu dự án</span>
						</a>
					</li>
					<li>
						<a href="@Url.Action("Index", "Tracuulocxuat")" data-tooltip="Lịch sử lọc xuất">
							<i class='bx bx-history'></i>
							<span class="text">Lịch sử lọc xuất</span>
						</a>
					</li>
				}

				<li>
					<a href="@Url.Action("Logout", "LoginRegister")" class="logout" data-tooltip="Đăng Xuất">
						<i class='bx bxs-log-out-circle'></i>
						<span class="text">Đăng Xuất</span>
					</a>
				</li>
				<li>
					<a href="@Url.Action("Login", "LoginRegister")" class="logout" data-tooltip="ĐĂNG NHẬP">
						<i class='bx bxs-log-in-circle'></i>
						<span class="text">ĐĂNG NHẬP</span>
					</a>
				</li>
				<li>
					<a href="#" class="menu-toggle" id="menu-toggle" data-tooltip="Thu gọn menu">
						<i class='bx bx-chevron-left'></i>
						<span class="text">Thu gọn menu</span>
					</a>
				</li>
			}
			else
			{
				<li>
					<a href="@Url.Action("Login", "LoginRegister")" class="logout" data-tooltip="ĐĂNG NHẬP">
						<i class='bx bxs-log-in-circle'></i>
						<span class="text">ĐĂNG NHẬP</span>
					</a>
				</li>
				<li>
					<a href="#" class="menu-toggle" id="menu-toggle" data-tooltip="Thu gọn menu">
						<i class='bx bx-chevron-left'></i>
						<span class="text">Thu gọn menu</span>
					</a>
				</li>
			}
		</ul>
	</section>
	<!-- SIDEBAR -->
	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<a href="#" class="nav-link">CÔNG TY TNHH CI RESEARCH</a>
			<form action="#">
			</form>
			<input type="checkbox" id="switch-mode" hidden>
			@{
				// Lấy thông báo từ session và tách chúng bằng dấu ';'
				var notifications = Context.Session.GetString("Notifications")?.Split(';') ?? new string[] { };
			}





			<a href="#" class="profile">
				@if (Context.Session.GetString("Username") != null)
				{
					<span style="color: black;">Xin chào @Context.Session.GetString("Username")!</span>
				}

			</a>
		</nav>
		<!-- NAVBAR -->
		<!-- MAIN -->
		<main>
			@RenderBody()
		</main>
		<!-- MAIN -->
	</section>
	<!-- CONTENT -->
	@RenderSection("Scripts", required: false)


	<script src="~/adminpanel/js/script.js"></script>
	<!-- jQuery -->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
	<script>
		// Unified sidebar management - removing conflicts
		document.addEventListener('DOMContentLoaded', function () {
			console.log('DOM loaded - unified sidebar system');
			var sidebar = document.getElementById('sidebar');
			console.log('Sidebar found:', sidebar);

			// Xử lý sự kiện khi người dùng nhấn nút toggle sidebar
			var toggleBtn = document.getElementById('menu-toggle');
			console.log('Toggle button found:', toggleBtn);

			if (toggleBtn && sidebar) {
				// Remove any existing event listeners to prevent conflicts
				toggleBtn.removeEventListener('click', arguments.callee);

				toggleBtn.addEventListener('click', function (e) {
					console.log('Sidebar toggle clicked');
					e.preventDefault();
					e.stopPropagation();

					// Use consistent class management
					sidebar.classList.toggle('hide');
					var isHidden = sidebar.classList.contains('hide');
					console.log('Sidebar is now:', isHidden ? 'collapsed' : 'expanded');
					console.log('Sidebar classes:', sidebar.classList.toString());

					// Đóng tất cả dropdown khi toggle sidebar
					document.querySelectorAll('.dropdown').forEach(function (item) {
						item.classList.remove('active');
					});

					// Force layout recalculation
					setTimeout(function () {
						window.dispatchEvent(new Event('resize'));
					}, 300);
				});
			} else {
				console.error('Toggle button or sidebar not found!');
			}

			// Xử lý dropdown menu
			var dropdowns = document.querySelectorAll('.dropdown > a');
			dropdowns.forEach(function (dropdown) {
				dropdown.addEventListener('click', function (e) {
					e.preventDefault();
					var parent = this.parentElement;
					var menu = parent.querySelector('.dropdown-menu');

					// Nếu sidebar bị collapsed, không cho mở dropdown
					if (sidebar.classList.contains('hide')) {
						return;
					}

					// Đóng tất cả dropdown khác
					document.querySelectorAll('.dropdown').forEach(function (item) {
						if (item !== parent) {
							item.classList.remove('active');
						}
					});

					// Toggle dropdown hiện tại
					parent.classList.toggle('active');
				});
			});

			// Đóng dropdown khi click bên ngoài
			document.addEventListener('click', function (e) {
				if (!e.target.closest('.dropdown')) {
					document.querySelectorAll('.dropdown').forEach(function (item) {
						item.classList.remove('active');
					});
				}
			});
		});	</script>
	<!-- Bootstrap JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>


</body>

</html>
