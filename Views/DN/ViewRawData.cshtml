@model List<CIResearch.Models.QLKH>

@{
    ViewData["Title"] = "D·ªØ li·ªáu th√¥ - CI Research";
    Layout = null;
}

<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css" rel="stylesheet">

    <style>
        /* Reset v√† Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-image: url('/IMG(4UU)/STOREAUDIT.jpg');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            background-attachment: fixed;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
        }

        /* Header Navigation */
        .top-nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        /* Navigation Filter Styles */
        .filter-toggle-btn {
            border-color: rgba(255, 255, 255, 0.5) !important;
            color: white !important;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            padding: 0.375rem 0.75rem;
        }

        .filter-toggle-btn:hover {
            background-color: rgba(255, 255, 255, 0.1) !important;
            border-color: white !important;
            color: white !important;
            transform: translateY(-1px);
        }

        .filter-toggle-btn:focus {
            box-shadow: 0 0 0 0.2rem rgba(255, 255, 255, 0.25) !important;
            color: white !important;
        }

        #navigationFilterSection {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 0 0 15px 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideDown 0.3s ease-out;
        }

        @@keyframes slideDown
        {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .nav-filter-container {
                padding: 1rem;
                border-radius: 10px;
                background: rgba(255, 255, 255, 0.05);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            .nav-filter-header {
                margin-bottom: 1rem;
                padding-bottom: 0.5rem;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            }

            .nav-filter-body .custom-multi-select {
                width: 100%;
                margin: 0;
            }

            .nav-filter-body .select-box {
                background-color: rgba(255, 255, 255, 0.9);
                border: 1px solid rgba(255, 255, 255, 0.3);
                border-radius: 6px;
                color: #333;
                font-size: 0.875rem;
                padding: 0.5rem;
            }

            .nav-filter-body .select-box:hover {
                background-color: white;
                border-color: #007bff;
            }

            .nav-filter-body .dropdown-options {
                background-color: white;
                border: 1px solid rgba(0, 0, 0, 0.1);
                border-radius: 6px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                z-index: 10000;
            }

            .nav-filter-body .btn {
                font-size: 0.875rem;
                padding: 0.4rem 0.8rem;
                border-radius: 6px;
                transition: all 0.2s ease;
            }

            .nav-filter-body .btn-outline-light {
                border-color: rgba(255, 255, 255, 0.5);
                color: white;
            }

            .nav-filter-body .btn-outline-light:hover {
                background-color: white;
                color: #333;
                border-color: white;
            }

            .nav-filter-body .btn-light {
                background-color: white;
                color: #333;
                border-color: white;
            }

            .nav-filter-body .btn-light:hover {
                background-color: #f8f9fa;
                transform: translateY(-1px);
            }

            .nav-filter-body .btn-success {
                background-color: #28a745;
                border-color: #28a745;
            }

            .nav-filter-body .btn-success:hover {
                background-color: #218838;
                transform: translateY(-1px);
            }

            .nav-filter-body .btn-info {
                background-color: #17a2b8;
                border-color: #17a2b8;
            }

            .nav-filter-body .btn-info:hover {
                background-color: #138496;
                transform: translateY(-1px);
            }

            .nav-filter-body .btn-warning {
                background-color: #ffc107;
                border-color: #ffc107;
                color: #333;
            }

            .nav-filter-body .btn-warning:hover {
                background-color: #e0a800;
                transform: translateY(-1px);
            }

            /* Chevron animation */
            #filterChevron {
                transition: transform 0.3s ease;
            }

            #filterChevron.rotated {
                transform: rotate(180deg);
            }

            /* Mobile responsiveness for navigation filter */
            @@media (max-width: 768px) {
                    .nav-filter-body .row .col-lg-2 {
                        margin-bottom: 0.5rem;
                    }

                    .filter-toggle-btn {
                        font-size: 0.75rem;
                        padding: 0.25rem 0.5rem;
                    }

                    .filter-toggle-btn span {
                        display: none;
                    }

                    .nav-filter-container {
                        padding: 0.75rem;
                    }

                    .nav-filter-body .btn {
                        font-size: 0.75rem;
                        padding: 0.3rem 0.6rem;
                    }
                }

                @@media(max - width: 576px) {
                        .top-nav {
                            padding: 0.75rem 0;
                        }

                        .nav-brand {
                            font-size: 1.2rem;
                        }

                        .user-info {
                            font-size: 0.8rem;
                        }
                    }

                    .nav-brand {
                        color: white;
                        font-size: 1.5rem;
                        font-weight: 700;
                        text-decoration: none;
                        display: flex;
                        align-items: center;
                    }

                    .nav-brand:hover {
                        color: #f8f9fa;
                        text-decoration: none;
                    }

                    .nav-brand i {
                        margin-right: 0.5rem;
                    }

                    .user-info {
                        color: white;
                        font-weight: 500;
                    }

                    /* Filter styles */
                    .custom-multi-select {
                        position: relative;
                        width: 100%;
                        margin: 0 auto;
                    }

                    .select-box {
                        padding: 10px;
                        border: 1px solid #ccc;
                        cursor: pointer;
                        background-color: #fff;
                        position: relative;
                        border-radius: 8px;
                    }

                    .selected-options {
                        white-space: nowrap;
                        overflow: hidden;
                        text-overflow: ellipsis;
                        width: 100%;
                    }

                    .arrow {
                        position: absolute;
                        right: 10px;
                        top: 50%;
                        transform: translateY(-50%) rotate(45deg);
                        border: solid #666;
                        border-width: 0 2px 2px 0;
                        padding: 3px;
                    }

                    .dropdown-options {
                        display: none;
                        position: absolute;
                        top: 100%;
                        left: 0;
                        right: 0;
                        background-color: #fff;
                        border: 1px solid #ccc;
                        max-height: 200px;
                        overflow-y: auto;
                        z-index: 9999;
                        border-radius: 8px;
                        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
                    }

                    .custom-multi-select.active {
                        z-index: 10000;
                    }

                    .dropdown-options label {
                        display: block;
                        padding: 8px;
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }

                    .dropdown-options label:hover {
                        background-color: #f0f0f0;
                    }

                    .search-box {
                        width: 100%;
                        padding: 8px;
                        border: 1px solid #ddd;
                        border-bottom: 2px solid #007bff;
                        font-size: 14px;
                        outline: none;
                        border-radius: 8px 8px 0 0;
                    }

                    .search-box:focus {
                        border-color: #007bff;
                        box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
                    }

                    /* Container ch√≠nh */
                    .main-container {
                        width: 100%;
                        min-height: calc(100vh - 80px);
                        padding: 0;
                        margin: 0;
                    }

                    /* Content wrapper */
                    .content-wrapper {
                        width: 100%;
                        padding: 2rem;
                        background: rgba(255, 255, 255, 0.95);
                        backdrop-filter: blur(10px);
                        min-height: calc(100vh - 80px);
                    }

                    /* DataTable custom styles */
                    .table-container {
                        background: white;
                        border-radius: 15px;
                        padding: 20px;
                        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                        margin-top: 20px;
                    }

                    .dataTables_wrapper .dataTables_length,
                    .dataTables_wrapper .dataTables_filter,
                    .dataTables_wrapper .dataTables_info,
                    .dataTables_wrapper .dataTables_paginate {
                        margin-bottom: 10px;
                    }

                    .dataTables_wrapper .dataTables_paginate .paginate_button {
                        border-radius: 6px;
                        margin: 0 2px;
                    }

                    .table-striped>tbody>tr:nth-child(odd)>td {
                        background-color: rgba(0, 0, 0, 0.02);
                    }

                    /* Limit options styles */
                    .limit-options {
                        background: white;
                        border-radius: 12px;
                        padding: 20px;
                        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                        margin-bottom: 20px;
                        border: 1px solid #e5e7eb;
                    }

                    .limit-option {
                        display: flex;
                        align-items: center;
                        margin-bottom: 10px;
                        padding: 8px;
                        border-radius: 6px;
                        transition: background-color 0.2s;
                    }

                    .limit-option:hover {
                        background-color: #f8f9fa;
                    }

                    .limit-option input[type="radio"] {
                        margin-right: 10px;
                    }

                    .custom-range-inputs {
                        display: none;
                        margin-top: 10px;
                        padding: 10px;
                        background-color: #f8f9fa;
                        border-radius: 6px;
                        border: 1px solid #dee2e6;
                    }

                    .custom-range-inputs.show {
                        display: block;
                    }

                    .form-control-sm {
                        font-size: 0.875rem;
                    }

                    /* Error message styles */
                    .alert {
                        border-radius: 8px;
                        border: none;
                        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                    }

                    .alert-danger {
                        background: linear-gradient(45deg, #dc3545, #c82333);
                        color: white;
                    }

                    .alert-success {
                        background: linear-gradient(45deg, #28a745, #218838);
                        color: white;
                    }

                    .alert-info {
                        background: linear-gradient(45deg, #17a2b8, #138496);
                        color: white;
                    }

                    /* Button styles */
                    .btn {
                        border-radius: 8px;
                        transition: all 0.3s ease;
                        font-weight: 500;
                    }

                    .btn:hover {
                        transform: translateY(-1px);
                        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
                    }

                    /* Statistics section */
                    .statistics-section {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border-radius: 12px;
                        padding: 20px;
                        margin-bottom: 20px;
                        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                    }

                    .stat-item {
                        text-align: center;
                        padding: 10px;
                    }

                    .stat-number {
                        font-size: 2rem;
                        font-weight: 700;
                        margin-bottom: 5px;
                    }

                    .stat-label {
                        font-size: 0.9rem;
                        opacity: 0.9;
                    }
                </style>
            </head>

            <body>
                <!-- Top Navigation -->
                <nav class="top-nav">
                    <div class="container-fluid px-3">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <a href="@Url.Action("Index", "DN")" class="nav-brand">
                                    <i class="fas fa-table"></i>
                                    ViewRawData - D·ªØ li·ªáu th√¥
                                </a>
                            </div>
                            <div class="col-md-6 text-end">
                                <div class="d-flex align-items-center justify-content-end gap-3">
                                    <div class="user-info">
                                        <i class="fas fa-calendar-alt me-2"></i>
                                        @DateTime.Now.ToString("dd/MM/yyyy HH:mm")
                                    </div>

                                    <!-- Filter Toggle Button -->
                                    <button class="btn btn-outline-light btn-sm filter-toggle-btn"
                                        onclick="toggleNavigationFilter()" id="filterToggleBtn">
                                        <i class="fas fa-filter me-1" id="filterToggleIcon"></i>
                                        <span id="filterToggleText">B·ªô l·ªçc</span>
                                        <i class="fas fa-chevron-down ms-1" id="filterChevron"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Collapsible Filter Section -->
                        <div class="row mt-3" id="navigationFilterSection" style="display: none;">
                            <div class="col-12">
                                <div class="nav-filter-container">
                                    <div class="nav-filter-header">
                                        <h6 class="mb-0 text-white">
                                            <i class="fas fa-filter me-2"></i>
                                            B·ªô l·ªçc d·ªØ li·ªáu doanh nghi·ªáp
                                        </h6>
                                    </div>
                                    <div class="nav-filter-body">
                                        <form method="get" action="@Url.Action("ViewRawData", "DN")" class="filter-form">
                                            <div class="row g-2">
                                                <!-- NƒÉm Multi-select -->
                                                <div class="col-lg-2 col-md-4 col-sm-6">
                                                    <div class="custom-multi-select" id="yearFilter">
                                                        <div class="select-box" onclick="toggleDropdown(this)">
                                                            <span class="selected-options" data-placeholder="NƒÉm">NƒÉm</span>
                                                            <i class="arrow"></i>
                                                        </div>
                                                        <div class="dropdown-options">
                                                            <input type="text" class="search-box" placeholder="T√¨m ki·∫øm nƒÉm"
                                                                oninput="filterOptions(this)">
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- T·ªânh/Th√†nh ph·ªë Multi-select -->
                                                <div class="col-lg-2 col-md-4 col-sm-6">
                                                    <div class="custom-multi-select" id="provinceFilter">
                                                        <div class="select-box" onclick="toggleDropdown(this)">
                                                            <span class="selected-options"
                                                                data-placeholder="T·ªânh/Th√†nh ph·ªë">T·ªânh/Th√†nh ph·ªë</span>
                                                            <i class="arrow"></i>
                                                        </div>
                                                        <div class="dropdown-options">
                                                            <input type="text" class="search-box" placeholder="T√¨m ki·∫øm t·ªânh th√†nh"
                                                                oninput="filterOptions(this)">
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Lo·∫°i h√¨nh kinh t·∫ø Multi-select -->
                                                <div class="col-lg-2 col-md-4 col-sm-6">
                                                    <div class="custom-multi-select" id="businessTypeFilter">
                                                        <div class="select-box" onclick="toggleDropdown(this)">
                                                            <span class="selected-options" data-placeholder="Lo·∫°i h√¨nh kinh t·∫ø">Lo·∫°i
                                                                h√¨nh kinh t·∫ø</span>
                                                            <i class="arrow"></i>
                                                        </div>
                                                        <div class="dropdown-options">
                                                            <input type="text" class="search-box" placeholder="T√¨m ki·∫øm lo·∫°i h√¨nh"
                                                                oninput="filterOptions(this)">
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- V√πng kinh t·∫ø Multi-select -->
                                                <div class="col-lg-2 col-md-4 col-sm-6">
                                                    <div class="custom-multi-select" id="economicZoneFilter">
                                                        <div class="select-box" onclick="toggleDropdown(this)">
                                                            <span class="selected-options" data-placeholder="V√πng kinh t·∫ø">V√πng kinh
                                                                t·∫ø</span>
                                                            <i class="arrow"></i>
                                                        </div>
                                                        <div class="dropdown-options">
                                                            <input type="text" class="search-box"
                                                                placeholder="T√¨m ki·∫øm v√πng kinh t·∫ø" oninput="filterOptions(this)">
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Gi·ªõi h·∫°n d·ªØ li·ªáu - Custom dropdown -->
                                                <div class="col-lg-2 col-md-4 col-sm-6">
                                                    <div class="custom-multi-select" id="limitTypeFilter">
                                                        <div class="select-box" onclick="toggleDropdown(this)">
                                                            <span class="selected-options" data-placeholder="Gi·ªõi h·∫°n">Gi·ªõi
                                                                h·∫°n</span>
                                                            <i class="arrow"></i>
                                                        </div>
                                                        <div class="dropdown-options">
                                                            <!-- No search box for limit options -->
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Quick Actions -->
                                                <div class="col-lg-2 col-md-4 col-sm-6">
                                                    <div class="d-flex gap-1">
                                                        <button type="button" class="btn btn-outline-light btn-sm flex-fill"
                                                            onclick="clearAllFilters()" title="X√≥a b·ªô l·ªçc">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                        <button type="button" class="btn btn-outline-light btn-sm flex-fill"
                                                            onclick="debugFilters()" title="Debug filters">
                                                            <i class="fas fa-bug"></i>
                                                        </button>
                                                        <button type="button" class="btn btn-outline-light btn-sm flex-fill"
                                                            onclick="testExportExcel()" title="Test Export Excel">
                                                            <i class="fas fa-file-excel"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Action Buttons Row -->
                                            <div class="row mt-2">
                                                <div class="col-12">
                                                    <div class="d-flex flex-wrap gap-1 justify-content-center">
                                                        <button type="submit" class="btn btn-light btn-sm">
                                                            <i class="fas fa-search me-1"></i>
                                                            √Åp d·ª•ng b·ªô l·ªçc
                                                        </button>
                                                        <a href="@Url.Action("Index", "DN")" class="btn btn-success btn-sm">
                                                            <i class="fas fa-chart-bar me-1"></i>
                                                            Dashboard
                                                        </a>
                                                        <button type="button" class="btn btn-info btn-sm" onclick="exportToExcel()">
                                                            <i class="fas fa-file-excel me-1"></i>
                                                            Export Excel
                                                        </button>
                                                        <button type="button" class="btn btn-warning btn-sm"
                                                            onclick="showFilterGuide()">
                                                            <i class="fas fa-question-circle me-1"></i>
                                                            H∆∞·ªõng d·∫´n
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Hidden inputs for limit options -->
                                            <input type="hidden" name="limitType" id="limitTypeInput"
                                                value="@ViewBag.CurrentLimitType">
                                            <input type="hidden" name="customStart" id="customStartInput"
                                                value="@ViewBag.CurrentCustomStart">
                                            <input type="hidden" name="customEnd" id="customEndInput"
                                                value="@ViewBag.CurrentCustomEnd">
                                            <input type="hidden" name="customFilter" id="customFilterInput"
                                                value="@ViewBag.CurrentCustomFilter">
                                            <input type="hidden" name="evenStart" id="evenStartInput"
                                                value="@ViewBag.CurrentEvenStart">
                                            <input type="hidden" name="evenEnd" id="evenEndInput" value="@ViewBag.CurrentEvenEnd">
                                            <input type="hidden" name="oddStart" id="oddStartInput"
                                                value="@ViewBag.CurrentOddStart">
                                            <input type="hidden" name="oddEnd" id="oddEndInput" value="@ViewBag.CurrentOddEnd">
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>

                <!-- Main Container -->
                <div class="main-container">
                    <div class="content-wrapper">

                        <!-- Page Header -->
                        <div class="statistics-section">
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="stat-item">
                                        <div class="stat-number">@String.Format("{0:N0}", ViewBag.TotalRecords ?? 0)</div>
                                        <div class="stat-label">T·ªïng records</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-item">
                                        <div class="stat-number">@String.Format("{0:N0}", ViewBag.FilteredRecords ?? 0)</div>
                                        <div class="stat-label">Sau l·ªçc</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-item">
                                        <div class="stat-number">@String.Format("{0:N0}", ViewBag.DisplayedRecords ?? 0)</div>
                                        <div class="stat-label">Hi·ªÉn th·ªã</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-item">
                                        <div class="stat-number">
                                            @{
                                                var currentLimitType = ViewBag.CurrentLimitType?.ToString() ?? "first1000";
                                                var limitDisplayText = currentLimitType switch
                                                {
                                                    "first1000" => "1000 ƒë·∫ßu",
                                                    "last1000" => "1000 cu·ªëi",
                                                    "even" => "STT ch·∫µn",
                                                    "odd" => "STT l·∫ª",
                                                    "random" => "Random",
                                                    "custom" => "T·ª± ch·ªçn",
                                                    "all" => "T·∫•t c·∫£",
                                                    _ => "1000 ƒë·∫ßu"
                                                };
                                            }
                                            @limitDisplayText
                                        </div>
                                        <div class="stat-label">Gi·ªõi h·∫°n</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Error Message -->
                        @if (!string.IsNullOrEmpty(ViewBag.Error?.ToString()))
                        {
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                @ViewBag.Error
                            </div>
                        }

                        <!-- Success Message -->
                        @if (TempData["SuccessMessage"] != null)
                        {
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle me-2"></i>
                                @TempData["SuccessMessage"]
                            </div>
                        }

                        <!-- Data Table -->
                        <div class="table-container">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">
                                    <i class="fas fa-table me-2"></i>
                                    B·∫£ng d·ªØ li·ªáu doanh nghi·ªáp
                                </h5>
                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="refreshTable()">
                                        <i class="fas fa-sync-alt me-1"></i>
                                        L√†m m·ªõi
                                    </button>
                                                            <button type="button" class="btn btn-outline-success btn-sm" onclick="exportToExcel()" title="T·∫£i v·ªÅ file Excel v·ªõi d·ªØ li·ªáu hi·ªán t·∫°i">
                            <i class="fas fa-file-excel me-1"></i>
                            Export Excel
                        </button>
                                </div>
                            </div>

                            <div class="table-responsive">
                                <table id="dataTable" class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>STT</th>
                                            <th>NƒÉm</th>
                                            <th>M√£ s·ªë thu·∫ø</th>
                                            <th>T√™n DN</th>
                                            <th>Lo·∫°i h√¨nh KT</th>
                                            <th>M√£ t·ªânh</th>
                                            <th>M√£ huy·ªán</th>
                                            <th>M√£ x√£</th>
                                            <th>ƒê·ªãa ch·ªâ</th>
                                            <th>ƒêi·ªán tho·∫°i</th>
                                            <th>Email</th>
                                            <th>V√πng KT</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model)
                                        {
                                            <tr>
                                                <td>@item.STT</td>
                                                <td>@item.Nam</td>
                                                <td>@(item.Masothue ?? "N/A")</td>
                                                <td>@(item.TenDN ?? "N/A")</td>
                                                <td>@(item.Loaihinhkte ?? "N/A")</td>
                                                <td>@(item.MaTinh_Dieutra ?? "N/A")</td>
                                                <td>@(item.MaHuyen_Dieutra ?? "N/A")</td>
                                                <td>@(item.MaXa_Dieutra ?? "N/A")</td>
                                                <td>@(item.Diachi ?? "N/A")</td>
                                                <td>@(item.Dienthoai ?? "N/A")</td>
                                                <td>@(item.Email ?? "N/A")</td>
                                                <td>@(item.Region ?? "N/A")</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Bootstrap JS Bundle -->
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
                <!-- jQuery -->
                <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
                <!-- DataTables JS -->
                <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
                <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
                <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
                <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>

                <!-- Navigation Filter JavaScript Functions -->
                <script>
                    // Navigation Filter Toggle Function
                    function toggleNavigationFilter() {
                        const filterSection = document.getElementById('navigationFilterSection');
                        const filterChevron = document.getElementById('filterChevron');
                        const toggleText = document.getElementById('filterToggleText');
                        const toggleIcon = document.getElementById('filterToggleIcon');

                        if (filterSection.style.display === 'none' || !filterSection.style.display) {
                            // Show filter
                            filterSection.style.display = 'block';
                            filterChevron.classList.add('rotated');
                            toggleText.textContent = 'Thu g·ªçn';
                            toggleIcon.className = 'fas fa-chevron-up me-1';

                            // Save state to localStorage
                            localStorage.setItem('navigationFilterExpanded', 'true');

                            console.log('üìñ Navigation filter expanded');
                        } else {
                            // Hide filter
                            filterSection.style.display = 'none';
                            filterChevron.classList.remove('rotated');
                            toggleText.textContent = 'B·ªô l·ªçc';
                            toggleIcon.className = 'fas fa-filter me-1';

                            // Save state to localStorage
                            localStorage.setItem('navigationFilterExpanded', 'false');

                            // Close any open dropdowns when hiding
                            document.querySelectorAll('.dropdown-options').forEach(dropdown => {
                                dropdown.style.display = 'none';
                            });

                            console.log('üìù Navigation filter collapsed');
                        }
                    }

                    // Toggle dropdown visibility
                    function toggleDropdown(element) {
                        const dropdown = element.nextElementSibling;
                        const isVisible = dropdown.style.display === 'block';

                        // Close all other dropdowns first
                        document.querySelectorAll('.dropdown-options').forEach(d => {
                            if (d !== dropdown) d.style.display = 'none';
                        });

                        // Toggle current dropdown
                        dropdown.style.display = isVisible ? 'none' : 'block';

                        // Update selected display
                        updateSelectedDisplay(element);
                    }

                    // Filter options based on search input
                    function filterOptions(searchInput) {
                        const filter = searchInput.value.toLowerCase();
                        const dropdown = searchInput.parentElement;
                        const labels = dropdown.querySelectorAll('label');

                        labels.forEach(label => {
                            const text = label.textContent.toLowerCase();
                            if (text.includes(filter)) {
                                label.style.display = 'block';
                            } else {
                                label.style.display = 'none';
                            }
                        });
                    }

                    // Update selected options display
                    function updateSelectedDisplay(selectBox) {
                        const dropdown = selectBox.nextElementSibling;
                        const selectedSpan = selectBox.querySelector('.selected-options');
                        const checkedInputs = dropdown.querySelectorAll('input[type="checkbox"]:checked, input[type="radio"]:checked');
                        const placeholder = selectedSpan.getAttribute('data-placeholder');

                        if (checkedInputs.length === 0) {
                            selectedSpan.textContent = placeholder;
                        } else if (checkedInputs.length === 1) {
                            selectedSpan.textContent = checkedInputs[0].nextSibling.textContent.trim();
                        } else {
                            selectedSpan.textContent = `${checkedInputs.length} m·ª•c ƒë√£ ch·ªçn`;
                        }
                    }

                    // Clear all filters
                    function clearAllFilters() {
                        // Uncheck all checkboxes and radio buttons
                        document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(input => {
                            input.checked = false;
                        });

                        // Reset all select displays
                        document.querySelectorAll('.select-box').forEach(selectBox => {
                            updateSelectedDisplay(selectBox);
                        });

                        // Clear hidden inputs
                        document.querySelectorAll('input[type="hidden"]').forEach(input => {
                            input.value = '';
                        });

                        console.log('üßπ All filters cleared');
                    }

                    // Close dropdowns when clicking outside
                    document.addEventListener('click', function (event) {
                        if (!event.target.closest('.custom-multi-select')) {
                            document.querySelectorAll('.dropdown-options').forEach(dropdown => {
                                dropdown.style.display = 'none';
                            });
                        }
                    });

                    // Initialize filter UI and load dynamic data
                    document.addEventListener('DOMContentLoaded', function () {
                        console.log('üîß Initializing ViewRawData filter UI...');

                        // Check saved state
                        const isExpanded = localStorage.getItem('navigationFilterExpanded') === 'true';

                        if (isExpanded) {
                            // Expand filter if it was previously expanded
                            setTimeout(() => {
                                toggleNavigationFilter();
                            }, 100);
                        }

                        // Load dynamic filter options from database
                        loadDynamicFilterOptions();

                        // Initialize DataTable
                        initializeDataTable();

                        document.querySelectorAll('.select-box').forEach(selectBox => {
                            updateSelectedDisplay(selectBox);
                        });
                    });

                    // Load dynamic filter options from database
                    function loadDynamicFilterOptions() {
                        console.log('üì° Loading dynamic filter options from database...');

                        fetch('/DN/GetFilterOptions')
                            .then(response => {
                                console.log('üì° Filter options response status:', response.status);
                                return response.json();
                            })
                            .then(data => {
                                console.log('üìä Filter options data:', data);

                                if (data.success) {
                                    console.log('‚úÖ Filter options loaded successfully');

                                    // Populate each filter dropdown
                                    populateFilterDropdown('yearFilter', data.filters.years, 'Nam', @Html.Raw(Json.Serialize(ViewBag.CurrentNam ?? new List<string>())));
                                    populateFilterDropdown('businessTypeFilter', data.filters.businessTypes, 'Loaihinhkte', @Html.Raw(Json.Serialize(ViewBag.CurrentLoaihinhkte ?? new List<string>())));
                                    populateFilterDropdown('provinceFilter', data.filters.provinces, 'MaTinh_Dieutra', @Html.Raw(Json.Serialize(ViewBag.CurrentMaTinh ?? new List<string>())));
                                    populateFilterDropdown('economicZoneFilter', data.filters.economicZones, 'Vungkinhte', @Html.Raw(Json.Serialize(ViewBag.CurrentVungkinhte ?? new List<string>())));

                                    // Populate limit type filter (different structure)
                                    populateLimitTypeFilter();

                                    // Initialize event listeners after options are loaded
                                    initializeFilterEventListeners();

                                    // Update display for all filters
                                    document.querySelectorAll('.select-box').forEach(selectBox => {
                                        updateSelectedDisplay(selectBox);
                                    });

                                    console.log('‚úÖ All filters populated successfully');
                                } else {
                                    console.error('‚ùå Failed to load filter options:', data.message);
                                    console.log('‚ö†Ô∏è Using fallback options');
                                    loadFallbackFilterOptions();
                                }
                            })
                            .catch(error => {
                                console.error('‚ùå Error loading filter options:', error);
                                console.log('‚ö†Ô∏è Using fallback options');
                                loadFallbackFilterOptions();
                            });
                    }

                    // Populate individual filter dropdown
                    function populateFilterDropdown(filterId, options, fieldName, currentValues) {
                        const filterElement = document.getElementById(filterId);
                        if (!filterElement) {
                            console.warn(`‚ö†Ô∏è Filter element ${filterId} not found`);
                            return;
                        }

                        const dropdown = filterElement.querySelector('.dropdown-options');
                        const searchBox = dropdown.querySelector('.search-box');

                        // Clear existing options (except search box)
                        const existingLabels = dropdown.querySelectorAll('label');
                        existingLabels.forEach(label => label.remove());

                        // Add new options
                        let optionsHTML = '';
                        options.forEach(option => {
                            const isChecked = currentValues && currentValues.includes(option) ? 'checked' : '';
                            optionsHTML += `
                                            <label>
                                                <input type="checkbox" name="${fieldName}" value="${option}" ${isChecked} /> ${option}
                                            </label>
                                        `;
                        });

                        // Insert after search box
                        if (searchBox) {
                            searchBox.insertAdjacentHTML('afterend', optionsHTML);
                        } else {
                            dropdown.innerHTML = optionsHTML;
                        }

                        console.log(`‚úÖ Populated ${filterId} with ${options.length} options`);
                    }

                    // Populate limit type filter (special handling)
                    function populateLimitTypeFilter() {
                        const filterElement = document.getElementById('limitTypeFilter');
                        if (!filterElement) {
                            console.warn('‚ö†Ô∏è Limit type filter element not found');
                            return;
                        }

                        const dropdown = filterElement.querySelector('.dropdown-options');
                        const currentLimitType = '@ViewBag.CurrentLimitType' || 'first1000';

                        const limitOptions = [
                            { value: 'first1000', text: '1000 ƒë·∫ßu ti√™n' },
                            { value: 'last1000', text: '1000 cu·ªëi c√πng' },
                            { value: 'even', text: 'STT ch·∫µn' },
                            { value: 'odd', text: 'STT l·∫ª' },
                            { value: 'random', text: 'Random 1000' },
                            { value: 'custom', text: 'T·ª± ch·ªçn kho·∫£ng' },
                            { value: 'all', text: 'T·∫•t c·∫£ (t·ªëi ƒëa 5000)' }
                        ];

                        let optionsHTML = '';
                        limitOptions.forEach(option => {
                            const isChecked = currentLimitType === option.value ? 'checked' : '';
                            optionsHTML += `
                                            <label onclick="handleLimitTypeChange('${option.value}')">
                                                <input type="radio" name="limitTypeRadio" value="${option.value}" ${isChecked} /> ${option.text}
                                            </label>
                                        `;
                        });

                        dropdown.innerHTML = optionsHTML;
                        console.log('‚úÖ Populated limit type filter');
                    }

                    // Handle limit type change
                    function handleLimitTypeChange(limitType) {
                        console.log('üîÑ Limit type changed to:', limitType);

                        // Update hidden input
                        document.getElementById('limitTypeInput').value = limitType;

                        // Update display
                        const limitBox = document.getElementById('limitTypeFilter').querySelector('.select-box');
                        updateSelectedDisplay(limitBox);

                        // Show additional options for custom, even, odd
                        if (limitType === 'custom') {
                            promptCustomRange();
                        } else if (limitType === 'even') {
                            promptEvenRange();
                        } else if (limitType === 'odd') {
                            promptOddRange();
                        }
                    }

                    // Prompt for custom range
                    function promptCustomRange() {
                        const start = prompt('Nh·∫≠p STT b·∫Øt ƒë·∫ßu:', '1');
                        const end = prompt('Nh·∫≠p STT k·∫øt th√∫c:', '1000');
                        const filter = prompt('B·ªô l·ªçc (all/even/odd):', 'all');

                        if (start && end) {
                            document.getElementById('customStartInput').value = start;
                            document.getElementById('customEndInput').value = end;
                            document.getElementById('customFilterInput').value = filter || 'all';
                            console.log('‚úÖ Custom range set:', start, '-', end, filter);
                        }
                    }

                    // Prompt for even range
                    function promptEvenRange() {
                        const start = prompt('Nh·∫≠p STT ch·∫µn b·∫Øt ƒë·∫ßu:', '2');
                        const end = prompt('Nh·∫≠p STT ch·∫µn k·∫øt th√∫c:', '1000');

                        if (start && end) {
                            document.getElementById('evenStartInput').value = start;
                            document.getElementById('evenEndInput').value = end;
                            console.log('‚úÖ Even range set:', start, '-', end);
                        }
                    }

                    // Prompt for odd range
                    function promptOddRange() {
                        const start = prompt('Nh·∫≠p STT l·∫ª b·∫Øt ƒë·∫ßu:', '1');
                        const end = prompt('Nh·∫≠p STT l·∫ª k·∫øt th√∫c:', '999');

                        if (start && end) {
                            document.getElementById('oddStartInput').value = start;
                            document.getElementById('oddEndInput').value = end;
                            console.log('‚úÖ Odd range set:', start, '-', end);
                        }
                    }

                    // Initialize event listeners after filters are populated
                    function initializeFilterEventListeners() {
                        // Add change event listeners to all checkboxes and radio buttons
                        document.querySelectorAll('.dropdown-options input[type="checkbox"], .dropdown-options input[type="radio"]').forEach(input => {
                            input.addEventListener('change', function () {
                                const selectBox = this.closest('.custom-multi-select').querySelector('.select-box');
                                updateSelectedDisplay(selectBox);
                            });
                        });

                        console.log('‚úÖ Filter event listeners initialized');
                    }

                    // Fallback options if API fails
                    function loadFallbackFilterOptions() {
                        const fallbackData = {
                            years: ['2018', '2019', '2020', '2021', '2022', '2023', '2024'],
                            businessTypes: ['C√¥ng ty TNHH', 'C√¥ng ty c·ªï ph·∫ßn', 'Doanh nghi·ªáp t∆∞ nh√¢n', 'Doanh nghi·ªáp nh√† n∆∞·ªõc'],
                            provinces: ['H√† N·ªôi', 'H·ªì Ch√≠ Minh', 'ƒê√† N·∫µng', 'H·∫£i Ph√≤ng', 'C·∫ßn Th∆°'],
                            economicZones: ['ƒê√¥ng Nam B·ªô', 'ƒê·ªìng b·∫±ng S√¥ng H·ªìng', 'Duy√™n h·∫£i Nam Trung B·ªô']
                        };

                        populateFilterDropdown('yearFilter', fallbackData.years, 'Nam', []);
                        populateFilterDropdown('businessTypeFilter', fallbackData.businessTypes, 'Loaihinhkte', []);
                        populateFilterDropdown('provinceFilter', fallbackData.provinces, 'MaTinh_Dieutra', []);
                        populateFilterDropdown('economicZoneFilter', fallbackData.economicZones, 'Vungkinhte', []);
                        populateLimitTypeFilter();

                        initializeFilterEventListeners();
                        console.log('‚úÖ Fallback options loaded');
                    }

                    // Initialize DataTable
                    function initializeDataTable() {
                        $('#dataTable').DataTable({
                            responsive: true,
                            pageLength: 25,
                            order: [[0, 'asc']],
                            language: {
                                "sProcessing": "ƒêang x·ª≠ l√Ω...",
                                "sLengthMenu": "Hi·ªÉn th·ªã _MENU_ m·ª•c",
                                "sZeroRecords": "Kh√¥ng t√¨m th·∫•y d√≤ng n√†o ph√π h·ª£p",
                                "sInfo": "Hi·ªÉn th·ªã _START_ ƒë·∫øn _END_ trong t·ªïng s·ªë _TOTAL_ m·ª•c",
                                "sInfoEmpty": "Hi·ªÉn th·ªã 0 ƒë·∫øn 0 trong t·ªïng s·ªë 0 m·ª•c",
                                "sInfoFiltered": "(ƒë∆∞·ª£c l·ªçc t·ª´ _MAX_ m·ª•c)",
                                "sSearch": "T√¨m ki·∫øm:",
                                "oPaginate": {
                                    "sFirst": "ƒê·∫ßu",
                                    "sPrevious": "Tr∆∞·ªõc",
                                    "sNext": "Ti·∫øp",
                                    "sLast": "Cu·ªëi"
                                }
                            },
                            columnDefs: [
                                { targets: [0], width: "5%" },
                                { targets: [1], width: "7%" },
                                { targets: [2], width: "10%" },
                                { targets: [3], width: "20%" },
                                { targets: [4], width: "12%" },
                                { targets: [5, 6, 7], width: "7%" },
                                { targets: [8], width: "15%" },
                                { targets: [9, 10], width: "10%" },
                                { targets: [11], width: "7%" }
                            ]
                        });

                        console.log('‚úÖ DataTable initialized');
                    }

                    // Debug filters function
                    function debugFilters() {
                        console.log('üîç DEBUGGING FILTERS...');

                        const formData = new FormData();

                        // Collect all filter data
                        document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                            formData.append(cb.name, cb.value);
                        });

                        document.querySelectorAll('input[type="radio"]:checked').forEach(radio => {
                            formData.append(radio.name, radio.value);
                        });

                        document.querySelectorAll('input[type="hidden"]').forEach(hidden => {
                            if (hidden.value) {
                                formData.append(hidden.name, hidden.value);
                            }
                        });

                        // Log all collected data
                        for (let [key, value] of formData.entries()) {
                            console.log(`${key}: ${value}`);
                        }

                        // Call debug endpoint
                        fetch('/DN/DebugFilters?' + new URLSearchParams(formData))
                            .then(response => response.json())
                            .then(data => {
                                console.log('üìä Debug response:', data);
                                alert('Debug completed! Check console for details.');
                            })
                            .catch(error => {
                                console.error('‚ùå Debug error:', error);
                                alert('Debug failed: ' + error.message);
                            });
                    }

                    // Export to Excel function
                    function exportToExcel() {
                        console.log('üìä Exporting to Excel...');

                        const form = document.querySelector('.filter-form');

                        if (!form) {
                            alert('‚ùå Kh√¥ng t√¨m th·∫•y form filters. Vui l√≤ng th·ª≠ l·∫°i.');
                            return;
                        }

                        const formData = new FormData(form);

                        // Convert to URL parameters
                        const params = new URLSearchParams();

                        // Add all form data
                        for (let [key, value] of formData.entries()) {
                            params.append(key, value);
                        }

                        // Add hidden input values for limit options
                        const hiddenInputs = document.querySelectorAll('input[type="hidden"]');
                        hiddenInputs.forEach(input => {
                            if (input.value && input.name) {
                                params.append(input.name, input.value);
                            }
                        });

                        // Collect checkbox values (for multiple selections)
                        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
                        checkboxes.forEach(checkbox => {
                            if (checkbox.name && checkbox.value) {
                                params.append(checkbox.name, checkbox.value);
                            }
                        });

                        // Collect radio button values
                        const radios = document.querySelectorAll('input[type="radio"]:checked');
                        radios.forEach(radio => {
                            if (radio.name && radio.value) {
                                params.append(radio.name, radio.value);
                            }
                        });

                        console.log('üìä Export parameters:', params.toString());

                        // Create download link
                        const exportUrl = '/DN/ExportToExcel?' + params.toString();

                        // Show loading message
                        const originalText = event.target.innerHTML;
                        event.target.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>ƒêang xu·∫•t...';
                        event.target.disabled = true;

                        // Create a temporary link to trigger download
                        const link = document.createElement('a');
                        link.href = exportUrl;
                        link.style.display = 'none';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);

                        // Reset button after a short delay
                        setTimeout(() => {
                            event.target.innerHTML = originalText;
                            event.target.disabled = false;

                            // Show success message
                            const alertDiv = document.createElement('div');
                            alertDiv.className = 'alert alert-success alert-dismissible fade show mt-3';
                            alertDiv.innerHTML = `
                                <i class="fas fa-check-circle me-2"></i>
                                <strong>Th√†nh c√¥ng!</strong> File Excel ƒëang ƒë∆∞·ª£c t·∫£i v·ªÅ.
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            `;

                            // Insert alert before table container
                            const tableContainer = document.querySelector('.table-container');
                            if (tableContainer) {
                                tableContainer.parentNode.insertBefore(alertDiv, tableContainer);

                                // Auto remove alert after 5 seconds
                                setTimeout(() => {
                                    if (alertDiv.parentNode) {
                                        alertDiv.remove();
                                    }
                                }, 5000);
                            }
                        }, 1000);
                    }

                    // Refresh table function
                    function refreshTable() {
                        window.location.reload();
                    }

                            // Show filter guide
        function showFilterGuide() {
            const guide = `üéØ H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG B·ªò L·ªåC VIEWRAWDATA

üìã B·ªò L·ªåC NAVIGATION:
   ‚Ä¢ Click n√∫t "B·ªô l·ªçc" ƒë·ªÉ m·ªü/ƒë√≥ng
   ‚Ä¢ Multi-select: Gi·ªØ Ctrl + Click ƒë·ªÉ ch·ªçn nhi·ªÅu
   ‚Ä¢ Search: G√µ ƒë·ªÉ t√¨m ki·∫øm trong dropdown
   ‚Ä¢ T·ª± ƒë·ªông l∆∞u tr·∫°ng th√°i m·ªü/ƒë√≥ng

üîç C√ÅC B·ªò L·ªåC:
   ‚Ä¢ NƒÉm: Ch·ªçn nƒÉm d·ªØ li·ªáu
   ‚Ä¢ T·ªânh/Th√†nh ph·ªë: L·ªçc theo ƒë·ªãa ph∆∞∆°ng  
   ‚Ä¢ Lo·∫°i h√¨nh KT: L·ªçc theo lo·∫°i h√¨nh kinh t·∫ø
   ‚Ä¢ V√πng KT: L·ªçc theo v√πng kinh t·∫ø
   ‚Ä¢ Gi·ªõi h·∫°n: Ch·ªçn c√°ch hi·ªÉn th·ªã d·ªØ li·ªáu

üìä GI·ªöI H·∫†N D·ªÆ LI·ªÜU:
   ‚Ä¢ 1000 ƒë·∫ßu: Hi·ªÉn th·ªã 1000 records ƒë·∫ßu ti√™n
   ‚Ä¢ 1000 cu·ªëi: Hi·ªÉn th·ªã 1000 records cu·ªëi c√πng
   ‚Ä¢ STT ch·∫µn/l·∫ª: L·ªçc theo s·ªë th·ª© t·ª±
   ‚Ä¢ T·ª± ch·ªçn: Nh·∫≠p kho·∫£ng STT t√πy √Ω
   ‚Ä¢ T·∫•t c·∫£: Hi·ªÉn th·ªã t·ªëi ƒëa 5000 records

‚ö° T√çNH NƒÇNG:
   ‚Ä¢ Export Excel: Xu·∫•t d·ªØ li·ªáu ƒë√£ l·ªçc
   ‚Ä¢ Debug: Ki·ªÉm tra b·ªô l·ªçc
   ‚Ä¢ DataTable: T√¨m ki·∫øm, s·∫Øp x·∫øp, ph√¢n trang
   ‚Ä¢ Responsive: T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh tr√™n mobile

üí° M·∫∏O:
   ‚Ä¢ D√πng t√¨m ki·∫øm trong dropdown ƒë·ªÉ t√¨m nhanh
   ‚Ä¢ C√≥ th·ªÉ ch·ªçn nhi·ªÅu m·ª•c trong c√πng b·ªô l·ªçc
   ‚Ä¢ B·ªô l·ªçc s·∫Ω nh·ªõ tr·∫°ng th√°i khi ƒëi·ªÅu h∆∞·ªõng

üì• EXPORT EXCEL:
   ‚Ä¢ Click n√∫t "Export Excel" ƒë·ªÉ t·∫£i file
   ‚Ä¢ File s·∫Ω ch·ª©a ƒë√∫ng d·ªØ li·ªáu ƒëang hi·ªÉn th·ªã
   ‚Ä¢ Bao g·ªìm t·∫•t c·∫£ c·ªôt v√† th√¥ng tin filter
   ‚Ä¢ T√™n file c√≥ timestamp v√† th√¥ng tin b·ªô l·ªçc`;
            
            alert(guide);
        }

        // Test Export Excel function
        function testExportExcel() {
            console.log('üß™ TESTING EXPORT EXCEL FUNCTION...');
            
            // Check if form exists
            const form = document.querySelector('.filter-form');
            console.log('üìã Form found:', form ? 'Yes' : 'No');
            
            if (!form) {
                alert('‚ùå Form not found for export');
                return;
            }
            
            // Collect all form data for testing
            const formData = new FormData(form);
            const params = new URLSearchParams();
            
            console.log('üìä Form elements found:');
            
            // Check form inputs
            const allInputs = form.querySelectorAll('input, select');
            console.log(`   - Total inputs: ${allInputs.length}`);
            
            // Check hidden inputs
            const hiddenInputs = document.querySelectorAll('input[type="hidden"]');
            console.log(`   - Hidden inputs: ${hiddenInputs.length}`);
            hiddenInputs.forEach(input => {
                if (input.value) {
                    console.log(`     - ${input.name}: ${input.value}`);
                    params.append(input.name, input.value);
                }
            });
            
            // Check checkboxes
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            console.log(`   - Checked checkboxes: ${checkboxes.length}`);
            checkboxes.forEach(checkbox => {
                console.log(`     - ${checkbox.name}: ${checkbox.value}`);
                params.append(checkbox.name, checkbox.value);
            });
            
            // Check radio buttons
            const radios = document.querySelectorAll('input[type="radio"]:checked');
            console.log(`   - Selected radios: ${radios.length}`);
            radios.forEach(radio => {
                console.log(`     - ${radio.name}: ${radio.value}`);
                params.append(radio.name, radio.value);
            });
            
            const exportUrl = '/DN/ExportToExcel?' + params.toString();
            console.log('üîó Export URL:', exportUrl);
            
            alert(`‚úÖ Export URL generated successfully!\n\nParameters found:\n- Hidden inputs: ${hiddenInputs.length}\n- Checkboxes: ${checkboxes.length}\n- Radio buttons: ${radios.length}\n\nCheck console for details.`);
            
            return exportUrl;
        }
                </script>
            </body>

            </html>